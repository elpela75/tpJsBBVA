<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="./wc-login-style.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">

<dom-module id="wc-login">
  <template>
    <style include="wc-login-style"></style>  

    <h2 on-click="toggle">{{mensajeinicial}}</h2>

    <iron-ajax
      id="ajaxperfil"       
      url="https://techcodewars.herokuapp.com/api/v1/users/[[usuario]]"
      handle-as="json"
      last-response="{{resultado}}"
      loading="{{cargando}}"
      on-response="respuestaRecibidaDeCodeWars"
      on-error="errorRecibidoDeCodeWars">
    </iron-ajax>

    <iron-collapse opened="[[desplegado]]">
        <div class="collapse">
            <paper-input value={{usuario}} placeholder="usuario"></paper-input>
            <paper-button id="btnLogin" raised class="indigo" on-click="login">Ver Perfil...</paper-button>
            <!--<paper-input value={{resultado.name}}></paper-input>-->
          </div>
    </iron-collapse>

    <paper-spinner class="spinner" alt="Cargando datos..." active="[[cargando]]"></paper-spinner>
  </template>

  <script>
    class WcLogin extends Polymer.Element {
      static get is() { 
        return 'wc-login'; 
      }
      static get properties() {
        return {
          cargando: {
            type: Boolean
          },
          mensajeinicial: {
            type: String,
            value: 'Hola! (soy el valor por default)'
          },
          usuario: {
            type: String,
            value: ""
          },
          desplegado: {
              type: Boolean,
              value: false
          },
          resultado: {
            type: Object,
            notify: true
          }
        };
      }

      toggle() {
       this.desplegado = !this.desplegado;
      }

      cancelar() {
        this.usuario = "";
        this.toggle();
      }

      login() {
        if ("" == this.usuario) {
          alert("Ingresá el usuario...");
          return;
        }
        this.$.ajaxperfil.generateRequest();
      }

      respuestaRecibidaDeCodeWars (e, request) {
        if(request.succeeded) {
          this.resultado = request.response;
          console.log(this.resultado, request.status);
        } else {
          console.info('la solicitud nos ofreció resultados incorrectos, con código ' + request.status);
        }
      }

      errorRecibidoDeCodeWars (e, error) {
        console.log(error.request, error.request.status); //ese es el iron-request de la solicitud
      }

      constructor() {
        super();
        //console.log('construyo el webcomponente wc-login.html');
      }

      connectedCallback() {
        super.connectedCallback();
        //console.log('paso por el connectedCallback() del webcomponente wc-login.html');
      }

      disconnectedCallback() {
        super.disconnectedCallback();
        //console.log('paso por el disconnectedCallback() del webcomponente wc-login.html');
      }

      attributeChangedCallback(nombre, valorAnterior, valorNuevo) {
        super.attributeChangedCallback();
        console.log('Ejecutándose attributeChangedCallback del webcomponente wc-login.html', nombre, valorAnterior, valorNuevo);
      }

      ready() {
        super.ready();
        //console.log('Ejecutándose ready del webcomponente wc-login.html');
      }

    }

    window.customElements.define(WcLogin.is, WcLogin);
  </script>
</dom-module>
